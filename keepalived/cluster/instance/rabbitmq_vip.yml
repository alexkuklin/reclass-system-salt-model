classes:
- service.keepalived.cluster.single
parameters:
  _param:
    keepalived_rabbitemq_vrrp_script_content: 'rabbitmqctl cluster_status --formatter=erlang | grep -q "running_nodes.*$(hostname)"'
  keepalived:
    cluster:
      vrrp_scripts:
        rabbitemq_vip:
          content: ${_param:keepalived_rabbitemq_vrrp_script_content}
          interval: 30
          rise: 1
          fall: 2
      instance:
        VIP:
          track_script: rabbitemq_vip
